title: CMcut4U2 の 本編／CM 判定 ユーザー定義マクロ

## はじめに

CMcut4U2 Ver 0.4.0 で追加された
「本編／CM 判定 ユーザー定義マクロ」
機能についての説明です。

## 概要

* 自動で行う基本的な本編／CM 判定では、不十分な場合があるので、
  それを補助する為に番組毎に特有なパターンを登録して、
  本編／CM 判定の精度を上げる。
* ユーザー定義マクロの適用例としては、下記のものがある。
  * CM と区別が付かない次回予告を本編にする。
  * 番組冒頭のアイキャッチを CM にする。
  * 5秒、10秒の番宣を CM にする。
  * 本編判定されるTVショッピングを CM にする。



## マクロ定義の文法

* ファイル名は ```macro.txt``` で、置き場所は TS ファイルのある番組ディレクトリ
* 1行に 1定義を記述
* 定義は 範囲指定、条件、設定値の 3項目から成る
  <table>
    <tr>
      <th> 範囲指定 </th> <th> 条件 </th>  <th> 設定値 </th>
    </tr> 
    <tr>
      <td rowspan="3"> Cn </td>
      <td> Sn </td>
      <td rowspan="7"> CM or HON <br> ( C or H に省略可 ) </td>
    </tr>
    <tr>
      <td> UNImin-max ( UNI は U に省略可) </td>
    </tr>
    <tr>
      <td> ADDmin-max ( ADD は A に省略可) </td>
    </tr>

    <tr>
      <td rowspan="2"> Tmin-max </td>
      <td> UNImin-max ( UNI は U に省略可) </td>
    </tr>
    <tr>
      <td> ADDmin-max ( ADD は A に省略可) </td>
    </tr>
  </table>
* 各項目の説明

   | Cn       | n番目のチャプター (nは整数)を対象にする |
   | Sn       | n番目のセクション                      |
   | T        | 指定した範囲の時間を対象にする
   | min-max  |  開始-終了時間  秒(0.0-3600.0) 又は分：秒(00:00-60:00) 形式  |
   | ADD      | 連続したセクションの合計値が、指定した時間の範囲に収まったら真 |
   | UNI      | セクション単体の値が、指定した時間の範囲に収まったら真 |
   | CM       | 条件に一致したセクションを CM に設定する。|
   | HON      | 条件に一致したセクションを 本編 に設定する。|
* 各項目は空白文字(スペース、タブ)で区切る
* 行頭が # の場合はコメント行とする。
* ユーザー定義マクロが適用されるのは、デフォルトのルールが適用された後で、
  ユーザー定義マクロの判定中は、チャプター番号、セクション番号は、変動しない。
* 見やすくするために '''_ ''' を挿入しても良い。なお全ての '''_ ''' は無視される。
  <pre>
   T_50:00-59:00  UNI_0-999  CM
  </pre>

## 使用例

* 第2チャプターの第1セクションをCM にする。
  <pre>
  C2   S1   CM
  </pre>

* 50:00 から 59:00 までは全て CM にする。
  <pre>
  T50:00-59:00  UNI0-999  CM
  </pre>

* 0:00 から 60:00 の間の、10秒±0.5 は全て CM にする。
  <pre>
  T_0:00-60:00  UNI_9.5-10.5  CM
  </pre>

* 最後の方にある 5分のTVショッピングを CM にする。
  <pre>
  T_45:00-60:00  A_299.5-300.5  CM
  </pre>
