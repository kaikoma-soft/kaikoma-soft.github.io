title: Raspberry Pi 3B+ ＋ PX-Q3U4 で録画サーバー ( ドライバ更新結果 )



## 目的

2019/04/13 に px4_drv が更新され、
同時に 5ch に作者さんからドロップ低減の為の設定についての記事が投稿された。

設定内容
+ /boot/cmdline.txt に「dwc_otg.host_rx_fifo_size=2048」を追記
+ /etc/modprobe.d/px4_drv.conf というファイルを作成し、
  以下のような内容を記述する
  + rev: 87以降の場合<br>
  「 options px4_drv xfer_packets=51 urb_max_packets=816 max_urbs=6 」
  + rev: 86以前の場合<br>
  「 options px4_drv xfer_packets=51 max_urbs=64 」


そこで、最新版での性能測定を行う。


-----------------
## 結果

従来は最大 3本(mysql同居不可)が限界だったが、
最新版では 7本(mysql同居可)に素晴らしく改善された。(単体テスト時)
<br>
px4_drvの作者さんに感謝を。
<br>
<br>
＜追記＞
実運用のテストでは、６本同時から若干のドロップが発生するので、
その辺りが限界と思われる。

-----------------
## 単体での計測結果

条件
+ 録画時間は 10分
+ ドライバーは px4_drv version 0.1.0, rev: 104
+ apache, mysqld は起動中。負荷は掛けず。
+ recpt1 は stz版


| 条件              | ビットレート(Mbyte/秒) | drop数   |  判定
|-------------------|------------------------+----------+----------
| 地デジ×1         |        2.06            |     0    |  ○
| 地デジ×2         |        4.12            |     0    |  ○
| 地デジ×3         |        6.17            |     0    |  ○
| 地デジ×4         |        8.23            |    0     |  ○
| BS×1             |        2.33            |    0     |  ○
| BS×2             |        4.66            |    0     |  ○
| BS×3             |        6.99            |    0     |  ○
| BS×4             |        9.32            |    0     |  ○
| BS×4 + 地デジ×1 |       11.38            |    1     |  ○
| BS×4 + 地デジ×2 |       13.43            |    0     |  ○
| BS×4 + 地デジ×3 |       15.49            |    0     |  ○
| BS×4 + 地デジ×4 |       17.16            |  29238   |  ×


-----------------
## 実運用での計測結果

条件
+ 期間は 2019/04/16 〜 04/26
+ ドライバーは px4_drv version 0.1.0, rev: 104
+ 録画ソフトは epgrec una版 + 録画中は EPG更新を行わない改造
+ recpt1 は stz版
+ 録画時に b25 デコードはなし
+ 総録画時間は 248本  153.8H
+ 内訳は、
  1本     113本、
  2本同時  73本、
  3本同時  33本、
  4本同時   6本、
  5本同時   5本、
  6本同時  18本

| drop数             |   本数    | 備考                       |
|--------------------|-----------+----------------------------+
| 0 〜 1             |   243     |
| 2 〜 10            |     3     | 6本同時
| 11 〜 25           |     0     |
| 26 〜 50           |     0     | 
| 51 〜 100          |     1     | 6本同時
|101 〜 200          |     1     | 6本同時
| 計                 |   248     |

